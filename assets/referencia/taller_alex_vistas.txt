Vistas del taller de Alex
-- vw_asignaciones_tecnico --

asignacion_id (uuid)
empleado_id (uuid)
usuario_empleado_id (uuid)
rol_asignacion (rol_asignacion)
cita_id (uuid)
inicio (timestamptz)
fin (timestamptz)
estado (estado_cita)
cliente_id (uuid)
cliente_nombre (text)
vehiculo_id (uuid)
placa (text)
marca (text)
modelo (text)
anio (integer)
sucursal_id (uuid)
sucursal_nombre (text)

-- vw_citas_resumen --

cita_id (uuid)
inicio (timestamptz)
fin (timestamptz)
estado (estado_cita)
fuente (fuente_cita)
cliente_id (uuid)
cliente_nombre (text)
vehiculo_id (uuid)
placa (text)
marca (text)
modelo (text)
anio (integer)
sucursal_id (uuid)
sucursal_nombre (text)
servicios (ARRAY)

-- vw_estado_vehiculo --

vehiculo_id (uuid)
placa (text)
marca (text)
modelo (text)
anio (integer)
orden_id (uuid)
estado_orden (estado_orden_servicio)
fecha_inicio (timestamptz)
fecha_fin_estimada (timestamptz)
fecha_fin_real (timestamptz)

-- vw_historial_sucursal --

sucursal_id (uuid)
sucursal (text)
orden_id (uuid)
estado (estado_orden_servicio)
fecha_inicio (timestamptz)
fecha_fin_real (timestamptz)
cliente_id (uuid)
placa (text)
marca (text)
modelo (text)

-- vw_historial_vehiculo --

vehiculo_id (uuid)
placa (text)
marca (text)
modelo (text)
anio (integer)
orden_id (uuid)
numero_orden (text)
fecha_inicio (timestamptz)
fecha_fin_real (timestamptz)
estado (estado_orden_servicio)
total_servicios (numeric)
total_refacciones (numeric)
total_general (numeric)

-- vw_inventario_alerta --

refaccion_id (uuid)
sucursal_id (uuid)
sku (text)
nombre (text)
existencias (integer)
minimo_alerta (integer)

-- vw_totales_orden --

orden_id (uuid)
total_servicios (numeric)
total_refacciones (numeric)
total_general (numeric)
sucursal_id (uuid)


-- vw_dashboard_global  --

sucursal_id (uuid) (FK → sucursales.id)
sucursal_nombre (text)
total_citas (int) → número total de citas registradas en la sucursal
citas_hoy (int) → número de citas con inicio en la fecha actual
total_ordenes (int) → número total de órdenes de servicio creadas en la sucursal
ordenes_abiertas (int) → número de órdenes en estados activos (no cerradas, no entregadas, no canceladas)
ordenes_cerradas (int) → número de órdenes en estados cerrada o entregada
ingresos_totales (numeric) → suma de los montos de pagos con estado “pagado” en esa sucursal
refacciones_alerta (int) → cantidad de refacciones cuyo stock está igual o por debajo del mínimo
empleados_activos (int) → número de empleados activos relacionados con esa sucursal

-- vw_mapa_sucursales --

sucursal_id (uuid) → clave interna para drill-down en CRM
sucursal_nombre (text)
imagen_url (text) o archivo_id si usas la tabla archivos
direccion (text)
lat (numeric)
lng (numeric)
empleados_activos (int) → cuántos empleados están ligados a la sucursal
reportes_totales (int) → puede ser el conteo de órdenes de servicio, inspecciones o bitácora (según definas “reporte”)
citas_hoy (int) → opcional, para mostrar carga de trabajo inmediata en el mapa
telefono (text)
email_contacto (text)
capacidad_bahias (int)